<!-- PRODUCT FORM -->

<div class="container">
  <form
    enctype="multipart/form-data"
    *ngIf="formService.getIsAddProduct() || formService.getIsEditProduct()"
    [formGroup]="productForm"
    (ngSubmit)="onSubmit()"
    class="form"
  >
    <div class="close-wrapper">
      <button (click)="formService.hideForm()" class="close">✖</button>
    </div>
    <div class="content">
      <h1 class="title">{{ formService.getFormTitle() }}</h1>

      <div class="field">
        <p-inputGroupAddon>Название</p-inputGroupAddon>
        <input
          pInputText
          formControlName="title"
          placeholder="{{ product ? product.title : 'Название' }}"
        />

        <mat-error *ngIf="productForm.get('title').hasError('required')"
          >Требуется Название</mat-error
        >
      </div>
      <div class="field">
        <p-inputGroupAddon>Описание</p-inputGroupAddon>
        <input
          required
          pInputText
          formControlName="description"
          placeholder="{{ product ? product.description : 'Описание' }}"
        />
        <mat-error *ngIf="productForm.get('description').hasError('required')"
          >Требуется Описание</mat-error
        >
      </div>

      <div class="field">
        <p-inputGroupAddon>Розничная цена</p-inputGroupAddon>
        <input
          required
          pInputText
          formControlName="wholesalePrice"
          placeholder="{{
            product ? product.wholesalePrice : 'Розничная цена'
          }}"
        />
        <mat-error
          *ngIf="productForm.get('wholesalePrice').hasError('required')"
          >Требуется Розничная цена</mat-error
        >
      </div>

      <div class="field">
        <p-inputGroupAddon>Кол-во</p-inputGroupAddon>
        <input
          required
          pInputText
          formControlName="count"
          placeholder="{{ product ? product.count : 'Кол-во' }}"
        />
        <mat-error *ngIf="productForm.get('count').hasError('required')"
          >Требуется кол-во</mat-error
        >
      </div>

      <div class="field">
        <p-inputGroupAddon>Оптовая цена</p-inputGroupAddon>
        <input
          pInputText
          formControlName="retailPrice"
          placeholder="{{ product ? product.retailPrice : 'Оптовая цена' }}"
        />
        <mat-error *ngIf="productForm.get('retailPrice').hasError('required')"
          >Требуется Оптовая Цена</mat-error
        >
      </div>

      <div class="field">
        <p-inputGroupAddon>{{
          product ? product.country : "Страна"
        }}</p-inputGroupAddon>

        <p-dropdown
          formControlName="country"
          [filter]="true"
          [filterBy]="product?.country"
          [options]="countries"
          [optionLabel]="product?.country"
          placeholder="Выберите Страну"
        ></p-dropdown>

        <mat-error *ngIf="productForm.get('country').hasError('required')"
          >Требуется Страна</mat-error
        >
      </div>

      <div class="field">
        <p-inputGroupAddon>{{
          product ? product.category : "Категория"
        }}</p-inputGroupAddon>
        <p-dropdown
          formControlName="category"
          [filter]="true"
          filterBy="title"
          [options]="categories"
          optionLabel="title"
          placeholder="Выберите категорию"
        ></p-dropdown>

        <!-- <mat-select formControlName="category" required>
          @for (category of categories; track category) {
          <mat-option [value]="category.title">{{ category.title }}</mat-option
          >}
        </mat-select> -->
        <mat-error *ngIf="productForm.get('category').hasError('required')"
          >Требуется категория</mat-error
        >
      </div>

      <div class="field">
        <input
          (change)="onFileSelected($event)"
          accept="image/*"
          type="file"
          formControlName="imgSrc"
        />
        <mat-error *ngIf="productForm.get('imgSrc').hasError('required')"
          >Требуется изображение</mat-error
        >
      </div>
      <div
        class="fields-input-wrapper"
        *ngFor="let field of productForm.get('fields').controls"
        [formGroup]="field"
      >
        <div>
          <input pInputText formControlName="key" placeholder="Ключ" />
        </div>
        <div>
          <input pInputText formControlName="value" placeholder="Значение" />
        </div>
      </div>
      <button class="add-field" type="button" (click)="addField()">+</button>

      <button class="btn" mat-raised-button type="submit">Принять</button>
    </div>
  </form>

  <!-- CATEGORY FORM -->
  <form
    *ngIf="formService.getIsAddCategory() || formService.getIsUpdateCategory()"
    [formGroup]="productForm"
    (ngSubmit)="onSubmit()"
    class="form"
  >
    <div class="close-wrapper">
      <button (click)="formService.hideForm()" class="close">✖</button>
    </div>
    <div class="content">
      <h1 class="title">{{ formService.getFormTitle() }}</h1>

      <div class="field">
        <p-inputGroupAddon>{{ "Категория" }}</p-inputGroupAddon>
        <input
          pInputText
          formControlName="title"
          placeholder="{{ category ? category.title : 'Название' }}"
        />

        <mat-error *ngIf="productForm.get('title').hasError('required')"
          >Требуется Название</mat-error
        >
      </div>
      <div class="field">
        <p-inputGroupAddon>Описание</p-inputGroupAddon>
        <textarea
          pInputTextarea
          formControlName="description"
          placeholder="{{ category ? category.description : 'Описание' }}"
          (input)="updateParagraphs($event)"
        ></textarea>
        <mat-error *ngIf="productForm.get('description').hasError('required')"
          >Требуется Описание</mat-error
        >
      </div>

      <div class="field">
        <input
          (change)="onFileSelected($event)"
          accept="image/*"
          type="file"
          formControlName="imgSrc"
        />
        <mat-error *ngIf="productForm.get('imgSrc').hasError('required')"
          >Требуется изображение</mat-error
        >
      </div>

      <button class="btn" mat-raised-button type="submit">Принять</button>
    </div>
  </form>
</div>
